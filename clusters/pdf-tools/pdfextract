#!/usr/bin/env bash
set -euo pipefail

usage() {
  echo "Usage: $(basename "$0") FIRST_PAGE LAST_PAGE INPUT.pdf [OUTPUT.pdf]" >&2
  exit 1
}

need() {
  command -v "$1" >/dev/null 2>&1 || {
    echo "Missing dependency: $1" >&2
    exit 1
  }
}

[[ $# -lt 3 || $# -gt 4 ]] && usage

first="$1"
last="$2"
input="$3"
output="${4:-${input%.pdf}_p${first}-p${last}.pdf}"

[[ "$first" =~ ^[0-9]+$ && "$last" =~ ^[0-9]+$ ]] || usage
[[ -f "$input" ]] || { echo "Input not found: $input" >&2; exit 1; }

need gs

gs -sDEVICE=pdfwrite -dNOPAUSE -dBATCH -dSAFER \
   -dFirstPage="$first" \
   -dLastPage="$last" \
   -sOutputFile="$output" \
   "$input"
